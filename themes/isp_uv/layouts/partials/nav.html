<nav class="navbar navbar-expand-lg bg-body-tertiary fixed-top">
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01"
      aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
      <ul class="navbar-nav mx-auto mb-lg-0">
        {{ $mainMenu := .Site.Menus.main }}
        {{ range $mainMenu }}
          {{ if .HasChildren }}
            <li class="nav-item dropdown px-2 nav-item-highlight">
              <a class="nav-link dropdown-toggle a" href="{{ .URL }}" role="button" data-bs-toggle="dropdown"
                aria-expanded="false" data-has-children="true">
                {{ .Name }}
              </a>
              <ul class="dropdown-menu">
                {{ range .Children }}
                  <li><a class="dropdown-item a" href="{{ .URL }}">{{ .Name }}</a></li>
                {{ end }}
              </ul>
            </li>
          {{ else }}
            <li class="nav-item px-2 nav-item-highlight">
              <a class="nav-link a" aria-current="page" href="{{ .URL }}">{{ .Name }}</a>
            </li>
          {{ end }}
        {{ end }}
      </ul>
    </div>
  </div>
</nav>

<style>
  .navbar {
    --bs-navbar-padding-y: 0rem !important;
    background-color: #222 !important;
  }

  .a {
    color: #949494 !important;
  }

  .a:hover {
    color: #fff !important;
  }

  .navbar-nav .dropdown:hover .dropdown-menu {
    display: block;
  }

  .navbar-nav .dropdown-menu:hover {
    display: block;
  }

  .dropdown-menu {
    margin-top: 7px;
  }

  .navbar-toggler-icon {
    background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3e%3cpath stroke='white' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
  }

  .navbar-toggler {
    border: none;
  }

  .navbar-toggler:focus {
    outline: none;
  }

  .nav-item-highlight {
    padding: 0.4rem;
  }

  .nav-item-highlight:hover {
    background-color: #2d70aa !important;
  }

  .dropdown-menu {
    background-color: #fff !important;
    color: #000 !important;
  }

  .dropdown-item:hover {
    background-color: #2d70aa !important;
    color: #fff !important;
  }

  .navbar-nav li.nav-item .nav-link,
  .dropdown-menu .dropdown-item {
    transition: color 0.3s, background-color 0.3s;
  }

  .navbar-toggler:focus {
    box-shadow: none !important;
  }

  .nav-link.active, .dropdown-item.active {
    color: #fff !important;
    background-color: #007bff !important;
  }
</style>


<script>
document.addEventListener('DOMContentLoaded', function () {
  const currentPath = window.location.pathname;
  const menuItems = document.querySelectorAll('.navbar-nav .nav-link');

  // Marcar el enlace actual como activo
  menuItems.forEach(function (item) {
    if (item.getAttribute('href') === currentPath) {
      item.classList.add('active');
    }
  });

  const dropdownItems = document.querySelectorAll('.navbar-nav .dropdown-item');

  // Marcar el submenú actual como activo
  dropdownItems.forEach(function (item) {
    if (item.getAttribute('href') === currentPath) {
      item.classList.add('active');
      item.closest('.dropdown').querySelector('.dropdown-toggle').classList.add('active');
    }
  });

  // Manejar el clic en menús con submenús
  document.querySelectorAll('.dropdown-toggle[data-has-children="true"]').forEach(item => {
    let firstClick = false;  // Controlar el estado del primer clic
    item.addEventListener('click', function (e) {
      if (window.innerWidth < 992) {
        e.preventDefault();
        const dropdownMenu = this.nextElementSibling;
        const isOpen = dropdownMenu.classList.contains('show');
        
        if (!isOpen) {
          // Si el submenú no está abierto, ábrelo
          dropdownMenu.classList.add('show');
          this.classList.add('first-click');
          firstClick = true;  // Marcar como primer clic
        } else {
          // Si el submenú ya está abierto y es el segundo clic, redirige a la URL
          if (firstClick) {
            window.location.href = this.getAttribute('href');
          }
        }
      } else {
        window.location.href = this.getAttribute('href');
      }
    });

    // Resetear el estado del primer clic cuando se hace clic fuera del menú
    document.addEventListener('click', function (e) {
      if (!e.target.closest('.navbar-nav')) {
        firstClick = false;  // Resetear el primer clic
      }
    });
  });

  // Manejar el clic en opciones del submenú
  document.querySelectorAll('.navbar-nav .nav-link, .navbar-nav .dropdown-item').forEach(item => {
    item.addEventListener('click', function (e) {
      if (window.innerWidth < 992) {
        const dropdownMenu = this.nextElementSibling;
        
        if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
          e.preventDefault();
          if (this.classList.contains('active')) {
            dropdownMenu.classList.remove('show');
            this.classList.remove('active');
            window.location.href = this.getAttribute('href');
          } else {
            dropdownMenu.classList.add('show');
            this.classList.add('active');
          }
          return;
        }

        const navbarToggler = document.querySelector('.navbar-toggler');
        const navbarCollapse = document.querySelector('.navbar-collapse');
        
        if (navbarCollapse.classList.contains('show')) {
          navbarToggler.click();
        }
      }
    });
  });

  // Detectar clic fuera del menú para cerrarlo
  document.addEventListener('click', function (e) {
    if (!e.target.closest('.navbar-nav')) {
      document.querySelectorAll('.dropdown-menu').forEach(menu => {
        menu.classList.remove('show');
      });
      document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
        toggle.classList.remove('first-click');
      });
    }
  });
});

</script>


